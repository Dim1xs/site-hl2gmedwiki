<body style="background-color:#AAADAC;">
<p style="padding-left: 120px;"><a href="..\index.html">Return to Main Page</a></p>
<p style="padding-left: 90px; text-align: center;"><span style="font-size: 26px;"><strong>Creating your first <u>S</u>cripted&nbsp;<u>W</u>eapon</strong></span><br /> <span style="font-size: 16px;">Description: Guide to create SWep.<br /> Author: Dim1xs (not a professional in creating)</span></p>
<p style="padding-left: 90px; text-align: center;">&nbsp;</p>
<p style="padding-left: 90px; text-align: center;"><strong><span style="font-size: 26px;">READ THIS!</span></strong></p>
<p style="padding-left: 90px; text-align: center;"><span style="font-size: 16px;">The tutorial may not be perfect, because im still dont know all lua func.</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 26px;"><strong>Get started</strong></span></p>
<p style="padding-left: 90px; text-align: center;"><span style="font-size: 16px;">First of all, you need a program, that can open and edit <u><strong>Lua</strong></u> format files.<br /> Go to the directory (folder): <em>&lt;srceng&gt;/hl2/custom/hl2gmed/lua/weapons/</em></span></p>
<p style="padding-left: 90px; text-align: center;"><span style="font-size: 16px;">Now create a new directory, with a simple name (without spaces) for your weapon. (for example: weapon_thrower)<br /> I recommend naming the folder so that there is a prefix at the beginning: weapon_</span></p>
<p style="padding-left: 90px; text-align: center;"><span style="font-size: 16px;">I advise you to do this, because the game may have the same prefixes, and the game may break because of this.</span></p>
<p style="padding-left: 90px; text-align: center;">&nbsp;</p>
<p style="padding-left: 510px; text-align: left;"><strong><span style="font-size: 26px;">Main part</span></strong></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">in folder that you created, you need to create 3 files:</span><br /> ðŸ”µ<span style="font-size: 18px;"><strong>init.lua</strong></span></p>
<p style="padding-left: 510px; text-align: left;">ðŸ”µ<span style="font-size: 18px;"><strong>cl_</strong></span><span style="font-size: 18px;"><strong>init.lua</strong></span></p>
<p style="padding-left: 510px; text-align: left;">ðŸ”µ<span style="font-size: 18px;"><strong>shared.</strong></span><span style="font-size: 18px;"><strong>lua</strong></span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;"><strong>init.lua</strong>&nbsp;is run&nbsp;<strong><em>Serverside</em> </strong>functions.</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;"><strong>cl_init.lua&nbsp;</strong>is run&nbsp;<strong><em>Clientside</em> </strong>functions.</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;"><strong>shared.lua</strong>&nbsp;is run in both environments (<em><strong>server/clientside</strong></em>).</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Simply put the serverside/clientside code inside an if statement like so:</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
if SERVER then
    -- Serverside code --
end
 
if CLIENT then
    -- Clientside code --
end
</span> <br /><br /><br /></code></pre>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Now, for perfect work you have to open <strong>cl_init.lua </strong>and put here basic code:<br /><br /></span></p>
<p style="padding-left: 540px;"><span style="background-color: #999999;">include( "shared.lua" ) --Must be here, for normal client initialize without errors.<br /></span></p>
<p style="padding-left: 540px;"><span style="background-color: #999999;">function SWEP:DrawLargeWeaponBox( bSelected, xpos, ypos, boxWide, boxTall, selectedColor, alpha, number ) --Must be here so that it does not give an error.</span><br /><span style="background-color: #999999;">end</span></p>
<p style="padding-left: 540px;"><span style="background-color: #999999;">function SWEP:DrawModel( flags )</span><br /><span style="background-color: #999999;">end</span></p>
<p style="padding-left: 540px;"><span style="background-color: #999999;">function SWEP:MuzzleFlash( pos1, angles, type, firstPerson )</span><br /><span style="background-color: #999999;">end</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Now same for <strong>init.lua</strong>:<br /></span></p>
<p style="padding-left: 540px;"><span style="background-color: #999999;">include( "shared.lua" ) --Must be here, for normal server initialize without errors.<br /></span></p>
<p style="padding-left: 540px;"><span style="background-color: #999999;">function SWEP:CapabilitiesGet()</span><br /><span style="background-color: #999999;">end</span></p>
<p style="padding-left: 540px; text-align: left;">&nbsp;</p>
<h2 style="padding-left: 510px;">SWEP Functions</h2>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">You have to know, how classes in lua are working, for simple: If function has self: in the string it means self is the base class of the script. If you will dont have SWEP: or ENT: etc in your function name, self: will not work! Because SWEP: is like a structure.</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Okay so, you must put a basic functions like Name, Viewmodel, Worldmodel, so for that you can use same functions like in GMOD:</span></p>
<p style="text-align: left;"><span style="font-size: 16px;">&nbsp;</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
SWEP.Name = "Base Weapon"
SWEP.PrintName				= "#HL2_357Handgun"
SWEP.ViewModel			= "models/weapons/v_357.mdl"
SWEP.WorldModel			= "models/weapons/w_357.mdl"
SWEP.HoldType			= "python"
SWEP.Slot				= 1
SWEP.SlotPos		= 1
SWEP.Weight					= 7
SWEP.item_flags				= 0
SWEP.AutoSwitchTo			= 1
SWEP.AutoSwitchFrom			= 1
SWEP.BuiltRightHanded		= 0
SWEP.AllowFlipping				= 0 --actually does the same like ViewModelFlip in gmod.
SWEP.MeleeWeapon			= 0 --idk what it does.
SWEP.Spawnable 				   	= true
</span> <br /><br /><br /></code></pre>
<h2 style="padding-left: 510px;">Firearm Settings</h2>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Each weapon must have its parameters configured (cartridges, magazine stock, initial ammunition, type of cartridges)</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Fortunately, in this lua, the ammo def functions work the same way as in gmod, which means that they are tables, and I can show you 2 ways for setting up ammo.</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">First way, is making in like in default gmod swep:</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
--This determins how big each clip/magazine for the gun is. You can 
--set it to -1 to disable the ammo system, meaning primary ammo will 
--not be displayed and will not be affected.
SWEP.Primary.ClipSize = 126

--This sets the number of rounds in the clip when you first get the gun. Again it can be set to -1.
SWEP.Primary.DefaultClip = 126

--Obvious. Determines whether the primary fire is automatic. This should be true/false
SWEP.Primary.Automatic = false

--Sets the ammunition type the gun uses, see below for a list of types.
SWEP.Primary.Ammo = "357

SWEP.Secondary.ClipSize = -1
SWEP.Secondary.DefaultClip = -1
SWEP.Secondary.Automatic = false
SWEP.Secondary.Ammo = "None"
</span> <br /><br /><br /></code></pre>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">And here is the second way:</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
SWEP.Primary = 
{
	ClipSize=126,
	DefaultClip=126,
	Automatic = false,
	Ammo = "357",
}
SWEP.Secondary = 
{
	ClipSize=-1,
	DefaultClip=-1,
	Automatic = false,
	Ammo = "none",
}
</span> <br /><br /><br /></code></pre>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">I like the second way better, it looks clearer to me. </span></p>
<p style="text-align: left; padding-left: 510px;"><span style="font-size: 16px;"><strong>Ammo list:</strong></span></p>
<p style="padding-left: 540px;"><span style="font-size: 16px; background-color: #999999;">AR2 - Ammunition of the AR2/Pulse Rifle<br />AlyxGun - (name in-game "5.7mm Ammo")<br />Pistol - Ammunition of the 9MM Pistol <br />SMG1 - Ammunition of the SMG/MP7<br />357 - Ammunition of the .357 Magnum<br />XBowBolt - Ammunition of the Crossbow<br />Buckshot - Ammunition of the Shotgun<br />RPG_Round - Ammunition of the RPG/Rocket Launcher<br />SMG1_Grenade - Ammunition for the SMG/MP7 grenade launcher (secondary fire)</span></p>
<p style="padding-left: 540px;">&nbsp;</p>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">And the last one is Damage of SWEP: </span></p>

<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
SWEP.damage					= 15
</span> <br /><br /><br /></code></pre>

<h2 style="padding-left: 510px;">Animations</h2>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Now, i will show how to add a animations for the player: </span></p>

<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
SWEP.m_acttable				=
{
		{ ACT_RANGE_ATTACK1,			ACT_RANGE_ATTACK_AR2,			true },
	    { ACT_RELOAD,					ACT_RELOAD_SMG1,				true },
	    { ACT_IDLE,						ACT_IDLE_SMG1,					true },
	    { ACT_IDLE_ANGRY,				ACT_IDLE_ANGRY_SMG1,			true },
	    { ACT_WALK,						ACT_WALK_RIFLE,					true },

	{ ACT_HL2MP_IDLE,					ACT_HL2MP_IDLE_AR2,					false },
	{ ACT_HL2MP_RUN,					ACT_HL2MP_RUN_AR2,					false },
	{ ACT_HL2MP_IDLE_CROUCH,			ACT_HL2MP_IDLE_CROUCH_AR2,			false },
	{ ACT_HL2MP_WALK_CROUCH,			ACT_HL2MP_WALK_CROUCH_AR2,			false },
	{ ACT_HL2MP_GESTURE_RANGE_ATTACK,	ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2,	false },
	{ ACT_HL2MP_GESTURE_RELOAD,			ACT_HL2MP_GESTURE_RELOAD_AR2,		false },
	{ ACT_HL2MP_JUMP,					ACT_HL2MP_JUMP_AR2,					false },
	{ ACT_RANGE_ATTACK1,				ACT_RANGE_ATTACK_AR2,				false },
    { ACT_MP_STAND_IDLE,				ACT_HL2MP_IDLE_AR2,					false },
	{ ACT_MP_CROUCH_IDLE,				ACT_HL2MP_IDLE_CROUCH_AR2,			false },

	{ ACT_MP_RUN,						ACT_HL2MP_RUN_AR2,					false },
	{ ACT_MP_CROUCHWALK,				ACT_HL2MP_WALK_CROUCH_AR2,			false },

	{ ACT_MP_ATTACK_STAND_PRIMARYFIRE,	ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2,	false },
	{ ACT_MP_ATTACK_CROUCH_PRIMARYFIRE,	ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2,	false },

	{ ACT_MP_RELOAD_STAND,				ACT_HL2MP_GESTURE_RELOAD_AR2,		false },
	{ ACT_MP_RELOAD_CROUCH,				ACT_HL2MP_GESTURE_RELOAD_AR2,		false },

	{ ACT_MP_JUMP,						ACT_HL2MP_JUMP_AR2,					false },
};
</span> <br /><br /><br /></code></pre>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Sadly HoldType from gmod is still not realised, so we have to use a act table like in C++,tbelow this is a example with AR2 animations (aka rifle), if you want to change them, look for ACT Enums on gmod wiki, or wait untill they will be done in this wiki. </span></p>

<h2 style="padding-left: 510px;">Sounds</h2>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Sadly, you can't do the shoot sound with the same way like in gmod, and you have to use SWEP.SoundData table: </span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">That's probably same thing like in game weapon scripts (.txt)</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
SWEP.SoundData				=
{
	empty						= "Weapon_Pistol.Empty",
	single_shot				= "weapons/sound.wav" --any sound here
}
</span> <br /><br /><br /></code></pre>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Remember! You don't need to write 'sound/' in path! It puts it automatically!</span></p>
<h2 style="padding-left: 510px;">Functions</h2>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Now you gonna code!</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Starting from basics, SWEP:Initialize is used for defining values/bools and also is used for default weapon functions:</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:Initialize()
	self.m_bReloadsSingly	= false;
	self.m_bFiresUnderwater	= false;
end
</span> <br /><br /><br /></code></pre>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Below you can see 2 basic functions, they do the same thing that is written on them.</span></p>
<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">But of course i will give you a example, i'm not sure you could understand anything:</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:Initialize()
	self.IsBool = true -- it's gonna be true by default
    IsBool = true --the same but without self.
    
    self.RandVal = 5 -- it's gonna equals to 5 by default
    RandVal = 5 -- the same but without self.
end
</span> <br /><br /><br /></code></pre>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Next we will do the primary attack in our script!</span></p>

<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:PrimaryAttack()
	--code
end
</span> <br /><br /><br /></code></pre>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Every time you do the SWEP, don't forget to identify the entity of the player who uses the weapon!</span></p>
<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:PrimaryAttack()
	local pPlayer = self:GetOwner() --getting player who uses a weapon.
    
    if ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
		return;
	end

end
</span> <br /><br /><br /></code></pre>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Then there are primitive functions, animations, sound, subtraction of bullets from the clip:</span></p>

<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:PrimaryAttack()
	local pPlayer = self:GetOwner() --getting player who uses a weapon.
    
    if ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
		return;
	end
	
    if ( self.m_iClip1 <= 0 ) then --checking  for a empty clip
		if ( not self.m_bFireOnEmpty ) then
			self:Reload();
		else
			self:WeaponSound( 0 );
			self.m_flNextPrimaryAttack = 0.3;
		end

		return;
	end
    
    self:WeaponSound(1) --emit a shoot sound from SoundData
    self:SendWeaponAnim(ACT_VM_PRIMARYATTACK) --do the animation of viewmodel
    pPlayer:SetAnimation( 5 ) --do the animation of player
    self.m_iClip1 = self.m_iClip1 - 1; --remove one ammo from clip
    
    self.m_flNextPrimaryAttack = gpGlobals.curtime() + 0.10; --next primary attack after shoot

end
</span> <br /><br /><br /></code></pre>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">Okay, after that, i gonna show how to do the function for bullet, and recoil:</span></p>

<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:PrimaryAttack()
	local pPlayer = self:GetOwner() --getting player who uses a weapon.
    
    if ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
		return;
	end
	
    if ( self.m_iClip1 <= 0 ) then --checking  for a empty clip
		if ( not self.m_bFireOnEmpty ) then
			self:Reload();
		else
			self:WeaponSound( 0 );
			self.m_flNextPrimaryAttack = 0.3;
		end

		return;
	end
    
    self:WeaponSound(1) --emit a shoot sound from SoundData
    self:SendWeaponAnim(ACT_VM_PRIMARYATTACK) --do the animation of viewmodel
    pPlayer:SetAnimation( 5 ) --do the animation of player
    self.m_iClip1 = self.m_iClip1 - 1; --remove one ammo from clip
    
    self.m_flNextPrimaryAttack = gpGlobals.curtime() + 0.10; --next primary attack after shoot

	local vecSrc		= pPlayer:Weapon_ShootPosition(); --these two functions must be defined!
	local vecAiming		= pPlayer:GetAutoaimVector( 0.08715574274766 );

	-- vecSrc - position of fire, vecAiming - Directory where is shooting, bullet spread, distance, Ammo Type
	local info = FireBulletsInfo_t(1, vecSrc, vecAiming, vec3_origin,4096, self.m_iPrimaryAmmoType) -- actually BulletInfo table
    info.m_pAttacker = pPlayer --defining our attacker
    
    pPlayer:FireBullets( info ) --and shoot the bullet with info from table
    
    pPlayer:ViewPunch( QAngle( -0.5, random.RandomFloat( -1, 1 ), 0 ) ); -- recoil
end
</span> <br /><br /><br /></code></pre>

<p style="padding-left: 510px; text-align: left;"><span style="font-size: 16px;">And the last one thing is reload function:</span></p>

<pre style="padding-left: 540px;"><code><span style="background-color: #999999;"> 
function SWEP:Reload()
	ToHL2MPPlayer(self:GetOwner()):DoAnimationEvent( 3 ) -- do the reload animation
	return self:DefaultReload( self:GetMaxClip1(), self:GetMaxClip2(), 182 ); --actually reload our gun
end
</span> <br /><br /><br /></code></pre>

