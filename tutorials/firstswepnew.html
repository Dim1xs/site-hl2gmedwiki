<!DOCTYPE html>
<html>
   <head>
      <link href="../styles/style.css" rel="stylesheet" type="text/css" />
      <title>First SWEP</title>
   </head>

   <body> 
      <div id="mw-page-base" class="noprint"></div>
      <div id="mw-head-base" class="noprint"></div>
      <div id="content">
         <a id="top"></a>

         <a href="../index.html" title="GetBack">Return to Main Page</a>

         <h1>First Scripted Weapon</h1>
         <table style="padding: 2px; width: 100%; margin: -1px 0% 0px; border: 1px solid #aaa; border-left: 15px solid #333333; border-top: 0; background: #fbfbfb;"><tbody><tr><td style="width: 130px;"><a href="index43df.html" title="ConCommands"><img alt="Page white text.png" src="../img/Page_white_text.png" width="16" height="16"></a> <b>Description:</b></td><td>Article about SWEP.</td></tr>
         <tr><td><a href="indexfdbf.html" class="image" title="link=User:Dim1xs"><img alt="link=User:Dim1xs" src="../img/User.png" width="16" height="16"></a> <b>Author:</b></td><td><a href="../other/users/dim1xs.html" title="User:Dim1xs">Dim1xs</a></td></tr>
         <tr><td> <a href="index43df.html" title="ConCommands"><img alt="Calendar.png" src="../img/Calendar.png" width="16" height="16"></a> <b>Created:</b></td><td>September 28th 2023</td></tr>
         </tbody></table>
         <br>

         This article will learn you, how to create code your first Scirpted Weapon - SWEP
         <h1 id="firstHeading" class="firstHeading">Scripted Weapons</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Better known as a SWep (or SWEP in some cases) a scripted weapon is a weapon that has an underlying script controlling its operation. In this tutorial, we will be making a SWep with fire bullets function.
               <br />
            </div>
         </div>

         <h1 id="secondHeading" class="secondHeading">The Basic Layout</h1>
         <div id="bodyContent">
            <div id="contentSub">
               First of all, you need a program, that can open and edit Lua format files.<br />
                  <br />
               Go to the directory (folder): <i>'..   /lua/weapons/'</i><br />
                  <br />
               Now create a new folder, with a simple name (without spaces) for your weapon. (for example: weapon_gun)<br />
               I recommend naming the folder so that there is a prefix at the beginning: <i>'weapon_'</i><br />

               I advise you to do this, because the game may have the same prefixes, and the game may break because of this.<br />
               <br />
            </div>
         </div>

         <h1 id="thirdHeading" class="thirdHeading">Files</h1>
         <div id="bodyContent">
            <div id="contentSub">
               In folder that you created, you need to create 3 files:<br />
               <br />
                  ðŸ”µinit.lua<br />
                  <br />
                  ðŸ”µcl_init.lua<br />
                  <br />
                  ðŸ”µshared.lua<br />
                  <br />
               init.lua is run Serverside functions.<br />
               <br />
               cl_init.lua is run Clientside functions.<br />
               <br />
               shared.lua is run in both environments (server/clientside).<br />
               <br />
               Now, for perfect work you have to open cl_init.lua and put here basic code:<br />

               <pre class="lua" style="font-family: monospace;">
                  include( "shared.lua" ) --Must be here, for normal client initialize without errors.

function SWEP:DrawLargeWeaponBox( bSelected, xpos, ypos, boxWide, boxTall, selectedColor, alpha, number ) --Must be here so that it does not give an error.
end

function SWEP:DrawModel( flags )
end

function SWEP:MuzzleFlash( pos1, angles, type, firstPerson )
end
               </pre>
                <br />
               Now same for init.lua: <br />

                <pre class="lua" style="font-family: monospace;">
include( "shared.lua" ) --Must be here, for normal server initialize without errors.

function SWEP:CapabilitiesGet()
end
               </pre>
            </div>
         </div>

         <h1 id="fourthHeading" class="fourthHeading">SWEP Functions</h1>
         <div id="bodyContent">
            <div id="contentSub">
               You have to know, how classes in lua are working, for simple: If function has self: in the string it means self is the base class of the script. <br />
               If you will dont have SWEP: or ENT: etc in your function name, self: will not work! Because SWEP: is like a structure.<br />
               <br />
               Okay so, you must put a basic functions like Name, Viewmodel, Worldmodel, so for that you can use same functions like in GMOD:<br />

               <pre class="lua" style="font-family: monospace;">
SWEP.Name                  = "Base Weapon" --in SpawnMenu Name
SWEP.PrintName             = "#HL2_357Handgun"
SWEP.ViewModel             = "models/weapons/v_357.mdl"
SWEP.WorldModel            = "models/weapons/w_357.mdl"
SWEP.HoldType              = "python" --dont working
SWEP.Slot                  = 1
SWEP.SlotPos               = 1
SWEP.Weight                = 7
SWEP.item_flags            = 0
SWEP.AutoSwitchTo          = 1
SWEP.AutoSwitchFrom        = 1
SWEP.BuiltRightHanded      = 0
SWEP.AllowFlipping         = 0 --actually does the same like ViewModelFlip in gmod.
SWEP.MeleeWeapon           = 0 --idk what it does.
SWEP.Spawnable             = true
SWEP.AdminOnly             = false
               </pre>
            </div>
         </div>

         <h1 id="fifthHeading" class="fifthHeading">Firearm Settings</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Each weapon must have its parameters configured (cartridges, magazine stock, initial ammunition, type of cartridges)<br />
               <br />
               Fortunately, in this lua, the ammo def functions work the same way as in gmod, which means that they are tables, and I can show you 2 ways for setting up ammo. <br />
               <br />   
               First way, is making in like in default gmod swep:<br /> 

               <pre class="lua" style="font-family: monospace;">
--This determins how big each clip/magazine for the gun is. You can 
--set it to -1 to disable the ammo system, meaning primary ammo will 
--not be displayed and will not be affected.
SWEP.Primary.ClipSize = 126

--This sets the number of rounds in the clip when you first get the gun. Again it can be set to -1.
SWEP.Primary.DefaultClip = 126

--Obvious. Determines whether the primary fire is automatic. This should be true/false
SWEP.Primary.Automatic = false

--Sets the ammunition type the gun uses, see below for a list of types.
SWEP.Primary.Ammo = "357

SWEP.Secondary.ClipSize = -1
SWEP.Secondary.DefaultClip = -1
SWEP.Secondary.Automatic = false
SWEP.Secondary.Ammo = "None"
               </pre>

               And here is the second way:<br /> 

               <pre class="lua" style="font-family: monospace;">
SWEP.Primary = 
{
   ClipSize=126,
   DefaultClip=126,
   Automatic = false,
   Ammo = "357",
}
SWEP.Secondary = 
{
   ClipSize=-1,
   DefaultClip=-1,
   Automatic = false,
   Ammo = "none",
}
               </pre>
            I like the second way better, it looks clearer to me.<br />
            <br />

            <h3 id="AmmoList" class="AmmoList">Ammo list:</h3>

            <pre class="lua" style="font-family: monospace;">
AR2 - Ammunition of the AR2/Pulse Rifle
AlyxGun - (name in-game "5.7mm Ammo")
Pistol - Ammunition of the 9MM Pistol
SMG1 - Ammunition of the SMG/MP7
357 - Ammunition of the .357 Magnum
XBowBolt - Ammunition of the Crossbow
Buckshot - Ammunition of the Shotgun
RPG_Round - Ammunition of the RPG/Rocket Launcher
SMG1_Grenade - Ammunition for the SMG/MP7 grenade launcher (secondary fire)
            </pre>

            And the last one is Damage of SWEP:<br /> 


            <pre class="lua" style="font-family: monospace;">
SWEP.damage             = 15
            </pre>

            </div>
         </div>

         <h1 id="sixthHeading" class="sixthHeading">Player Animations</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Now, i will show how to add a animations for the player:<br />

               <pre class="lua" style="font-family: monospace;">
SWEP.m_acttable            =
{
   { ACT_RANGE_ATTACK1,       ACT_RANGE_ATTACK_AR2,         true },
   { ACT_RELOAD,             ACT_RELOAD_SMG1,           true },
   { ACT_IDLE,                  ACT_IDLE_SMG1,             true },
   { ACT_IDLE_ANGRY,            ACT_IDLE_ANGRY_SMG1,       true },
   { ACT_WALK,                  ACT_WALK_RIFLE,               true },

   { ACT_HL2MP_IDLE,             ACT_HL2MP_IDLE_AR2,              false },
   { ACT_HL2MP_RUN,              ACT_HL2MP_RUN_AR2,               false },
   { ACT_HL2MP_IDLE_CROUCH,         ACT_HL2MP_IDLE_CROUCH_AR2,       false },
   { ACT_HL2MP_WALK_CROUCH,         ACT_HL2MP_WALK_CROUCH_AR2,       false },
   { ACT_HL2MP_GESTURE_RANGE_ATTACK,   ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2, false },
   { ACT_HL2MP_GESTURE_RELOAD,         ACT_HL2MP_GESTURE_RELOAD_AR2,    false },
   { ACT_HL2MP_JUMP,             ACT_HL2MP_JUMP_AR2,              false },
   { ACT_RANGE_ATTACK1,          ACT_RANGE_ATTACK_AR2,            false },
    { ACT_MP_STAND_IDLE,            ACT_HL2MP_IDLE_AR2,              false },
   { ACT_MP_CROUCH_IDLE,            ACT_HL2MP_IDLE_CROUCH_AR2,       false },

   { ACT_MP_RUN,                 ACT_HL2MP_RUN_AR2,               false },
   { ACT_MP_CROUCHWALK,          ACT_HL2MP_WALK_CROUCH_AR2,       false },

   { ACT_MP_ATTACK_STAND_PRIMARYFIRE,  ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2, false },
   { ACT_MP_ATTACK_CROUCH_PRIMARYFIRE, ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2, false },

   { ACT_MP_RELOAD_STAND,           ACT_HL2MP_GESTURE_RELOAD_AR2,    false },
   { ACT_MP_RELOAD_CROUCH,          ACT_HL2MP_GESTURE_RELOAD_AR2,    false },

   { ACT_MP_JUMP,                ACT_HL2MP_JUMP_AR2,              false },
};
               </pre>

               Sadly HoldType from gmod is still not realised, so we have to use a act table like in C++, <br />
               below this is a example with AR2 animations (aka rifle), if you want to change them,<br /> 
               look for ACT Enums on gmod wiki, or wait untill they will be done in this wiki. <br />
               <br />
            </div>
         </div>

         <h1 id="seventhHeading" class="seventhHeading">Sounds</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Sadly, you can't do the shoot sound with the same way like in gmod, and you have to use SWEP.SoundData table:<br />
               <br />
               That's probably same thing like in game weapon scripts (.txt)<br />

               <pre class="lua" style="font-family: monospace;">
SWEP.SoundData          =
{
   empty                = "Weapon_Pistol.Empty",
   single_shot          = "weapons/sound.wav" --any sound here
}
               </pre>
               Remember! You don't need to write 'sound/' in path! It puts it automatically!<br />
               <br />
            </div>
         </div>

         <h1 id="eighthHeading" class="eighthHeading">Functions</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Now you gonna code!<br />
               <br />
               Starting from basics, SWEP:Initialize is used for defining values/bools and also is used for default weapon functions:<br />

               <pre class="lua" style="font-family: monospace;">
function SWEP:Initialize()
   self.m_bReloadsSingly   = false;
   self.m_bFiresUnderwater = false;
end
               </pre>
               Below you can see 2 basic functions, they do the same thing that is written on them.<br />
               <br />
               But of course i will give you a example, i'm not sure you could understand anything:<br />
               

               <pre class="lua" style="font-family: monospace;">
function SWEP:Initialize()
   self.IsBool = true -- it's gonna be true by default
    IsBool = true --the same but without self.
    
    self.RandVal = 5 -- it's gonna equals to 5 by default
    RandVal = 5 -- the same but without self.
end
               </pre>

               Next we will do the primary attack in our script!<br />
               

               <pre class="lua" style="font-family: monospace;">
function SWEP:PrimaryAttack()
   --code
end
               </pre>

               Every time you do the SWEP, don't forget to identify the entity of the player who uses the weapon!<br />
               

               <pre class="lua" style="font-family: monospace;">
function SWEP:PrimaryAttack()
   local pPlayer = self:GetOwner() --getting player who uses a weapon.
    
    if ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
      return;
   end

end
               </pre>

               Then there are primitive functions, animations, sound, subtraction of bullets from the clip:<br />
               

               <pre class="lua" style="font-family: monospace;">
function SWEP:PrimaryAttack()
   local pPlayer = self:GetOwner() --getting player who uses a weapon.
    
    if ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
      return;
   end
   
    if ( self.m_iClip1 <= 0 ) then --checking  for a empty clip
      if ( not self.m_bFireOnEmpty ) then
         self:Reload();
      else
         self:WeaponSound( 0 );
         self.m_flNextPrimaryAttack = 0.3;
      end

      return;
   end
    
    self:WeaponSound(1) --emit a shoot sound from SoundData
    self:SendWeaponAnim(ACT_VM_PRIMARYATTACK) --do the animation of viewmodel
    pPlayer:SetAnimation( 5 ) --do the animation of player
    self.m_iClip1 = self.m_iClip1 - 1; --remove one ammo from clip
    
    self.m_flNextPrimaryAttack = gpGlobals.curtime() + 0.10; --next primary attack after shoot

end
               </pre> 

               Okay, after that, i gonna show how to do the function for bullet, and recoil:<br />

               <pre class="lua" style="font-family: monospace;">
function SWEP:PrimaryAttack()
   local pPlayer = self:GetOwner() --getting player who uses a weapon.
    
    if ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
      return;
   end
   
    if ( self.m_iClip1 <= 0 ) then --checking  for a empty clip
      if ( not self.m_bFireOnEmpty ) then
         self:Reload();
      else
         self:WeaponSound( 0 );
         self.m_flNextPrimaryAttack = 0.3;
      end

      return;
   end
    
    self:WeaponSound(1) --emit a shoot sound from SoundData
    self:SendWeaponAnim(ACT_VM_PRIMARYATTACK) --do the animation of viewmodel
    pPlayer:SetAnimation( 5 ) --do the animation of player
    self.m_iClip1 = self.m_iClip1 - 1; --remove one ammo from clip
    
    self.m_flNextPrimaryAttack = gpGlobals.curtime() + 0.10; --next primary attack after shoot

   local vecSrc      = pPlayer:Weapon_ShootPosition(); --these two functions must be defined!
   local vecAiming      = pPlayer:GetAutoaimVector( 0.08715574274766 );

   -- vecSrc - position of fire, vecAiming - Directory where is shooting, bullet spread, distance, Ammo Type
   local info = FireBulletsInfo_t(1, vecSrc, vecAiming, vec3_origin,4096, self.m_iPrimaryAmmoType) -- actually BulletInfo table
    info.m_pAttacker = pPlayer --defining our attacker
    
    pPlayer:FireBullets( info ) --and shoot the bullet with info from table
    
    pPlayer:ViewPunch( QAngle( -0.5, random.RandomFloat( -1, 1 ), 0 ) ); -- recoil
end
               </pre>
                
            </div>
         </div>

         <h1 id="ninthHeading" class="ninthHeading">Reload</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Reload is must be ALWAYS look like that:<br />
               
               <pre class="lua" style="font-family: monospace;">
function SWEP:Reload()
   ToHL2MPPlayer(self:GetOwner()):DoAnimationEvent( 3 ) -- do the reload animation
   return self:DefaultReload( self:GetMaxClip1(), self:GetMaxClip2(), 182 ); --actually reload our gun
end
               </pre>
               <br />
            </div>
         </div>

         Thank you for reading this tutorial, see ya later!<br />
               <br />

               <a href="https://discord.com/invite/5er8wTvQu7" title="HL2GMEDDiscord">JOIN HL2GMED DISCORD SERVER!</a>
      </div>
      <div id="mw-panel" class="noprint collapsible bav"> 
         <div id="p-logo">
            <a style="background-image: url(img/logo.png);"> 
            </a>
         </div>
      </div>

      <div id="footer">
         <ul id="footer-info">
            <li id="footer-info-lastmod">
               This page was last modified on 28.09.2023
            </li>
            <li id="footer-info-viewcount">
               Thank you, for opening this page
            </li>
         </ul>
      </div>
   </body>

</html>